#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

cmd="${1:-}"
shift || true

open_obsidian() {
  local target="${1:-$REPO_ROOT}"
  if [[ "$target" != /* ]]; then
    target="$REPO_ROOT/$target"
  fi
  if [[ ! -e "$target" ]]; then
    echo "rbff: path not found: $target" >&2
    exit 1
  fi
  open -a "Obsidian" "$target"
}

case "$cmd" in
  open|"" )
    open_obsidian "${1:-$REPO_ROOT}"
    ;;
  help|--help|-h )
    cat <<'USAGE'
rbff open [path]  - open repo or specific file/folder in Obsidian
USAGE
    ;;
  * )
    echo "rbff: unknown command: $cmd" >&2
    exit 1
    ;;
esac
